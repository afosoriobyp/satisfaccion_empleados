{% extends 'base.html' %}

{% block body %}
<div class="card shadow mx-auto" style="max-width: 600px;">
    <div class="card-body">
        <h3 class="card-title mb-4">쮺칩mo te sientes hoy en el trabajo?</h3>
        
        <form action="/" method="POST">
            <!-- Campo oculto para garantizar que category siempre se env칤e -->
            <input type="hidden" name="category" id="hidden-category" value="N/A">
            
            <div class="emoji-container d-flex justify-content-around mb-4">
                
                <label class="emoji-option">
                    <input type="radio" name="level" value="rabia" required onclick="toggleCategory(true)">
                    <span class="face">游땨</span>
                    <div class="label-text">Molesto</div>
                </label>

                <label class="emoji-option">
                    <input type="radio" name="level" value="triste" onclick="toggleCategory(true)">
                    <span class="face">游땩</span>
                    <div class="label-text">Triste</div>
                </label>

                <label class="emoji-option">
                    <input type="radio" name="level" value="normal" onclick="toggleCategory(false)">
                    <span class="face">游땛</span>
                    <div class="label-text">Normal</div>
                </label>

                <label class="emoji-option">
                    <input type="radio" name="level" value="feliz" onclick="toggleCategory(false)">
                    <span class="face">游땏</span>
                    <div class="label-text">Feliz</div>
                </label>
            </div>

            <div id="category-section" class="mb-3 text-start d-none">
                <label class="form-label fw-bold">쮺u치l crees que es la causa ra칤z?</label>
                <select name="category-visible" id="category-select" class="form-select">
                    <option value="" selected disabled>Selecciona una causa...</option>
                    <option value="Personal">Personal / RRHH (Salarios, compa침eros)</option>
                    <option value="Procesos">Procesos / M칠todos (Burocracia, reglas)</option>
                    <option value="Tecnologia">Tecnolog칤a / Equipos (Computadores, internet)</option>
                    <option value="Ambiente">Ambiente / Infraestructura (Ruido, oficina)</option>
                </select>
            </div>

            <div class="mb-3">
                <textarea name="comment" class="form-control" placeholder="Comentario opcional..." rows="3"></textarea>
            </div>

            <button type="submit" class="btn btn-success w-100 btn-lg">Enviar Opini칩n</button>
        </form>
    </div>
</div>

<script>
    // Script para mostrar/ocultar la categor칤a y sincronizar valores
    function toggleCategory(show) {
        const section = document.getElementById('category-section');
        const selectElement = document.getElementById('category-select');
        const hiddenCategory = document.getElementById('hidden-category');
        
        if(show) {
            // Mostrar selector para emociones negativas
            section.classList.remove('d-none');
            selectElement.required = true;
            // NO desactivar el campo oculto, solo cambiar su valor
        } else {
            // Ocultar selector para emociones positivas/neutras
            section.classList.add('d-none');
            selectElement.required = false;
            selectElement.value = "";
            // Asegurar que el campo oculto tenga N/A
            hiddenCategory.value = "N/A";
        }
    }
    
    // Sincronizar el select visible con el campo oculto cuando cambie
    document.getElementById('category-select').addEventListener('change', function() {
        document.getElementById('hidden-category').value = this.value;
    });
</script>
{% endblock %}