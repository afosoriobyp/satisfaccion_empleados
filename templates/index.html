{% extends 'base.html' %}

{% block body %}
<div class="card shadow mx-auto" style="max-width: 600px;">
    <div class="card-body">
        <h3 class="card-title mb-4">쯄i emoci칩n del d&iacute;a es?</h3>
        
        <form action="/" method="POST">
            <!-- Campo oculto para garantizar que category siempre se env칤e -->
            <input type="hidden" name="category" id="hidden-category" value="N/A">
            
            <div class="emoji-container d-flex flex-wrap justify-content-center gap-2 mb-4">
                
                <label class="emoji-option emotion-miedo">
                    <input type="radio" name="level" value="miedo" required onclick="toggleCategory(true)">
                    <img src="{{ url_for('static', filename='img/miedo.png') }}" alt="Miedo" class="emotion-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span class="face" style="display:none;">游땯</span>
                    <div class="label-text">Miedo</div>
                </label>

                <label class="emoji-option emotion-furia">
                    <input type="radio" name="level" value="furia" onclick="toggleCategory(true)">
                    <img src="{{ url_for('static', filename='img/furia.png') }}" alt="Furia" class="emotion-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span class="face" style="display:none;">游땨</span>
                    <div class="label-text">Furia</div>
                </label>

                <label class="emoji-option emotion-tristeza">
                    <input type="radio" name="level" value="tristeza" onclick="toggleCategory(true)">
                    <img src="{{ url_for('static', filename='img/tristeza.png') }}" alt="Tristeza" class="emotion-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span class="face" style="display:none;">游땩</span>
                    <div class="label-text">Tristeza</div>
                </label>
                
                <label class="emoji-option emotion-desagrado">
                    <input type="radio" name="level" value="desagrado" onclick="toggleCategory(true)">
                    <img src="{{ url_for('static', filename='img/desagrado.png') }}" alt="Desagrado" class="emotion-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span class="face" style="display:none;">游뱍</span>
                    <div class="label-text">Desagrado</div>
                </label>
                
                <label class="emoji-option emotion-alegria">
                    <input type="radio" name="level" value="alegria" onclick="toggleCategory(false)">
                    <img src="{{ url_for('static', filename='img/alegria.png') }}" alt="Alegr칤a" class="emotion-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span class="face" style="display:none;">游땏</span>
                    <div class="label-text">Alegr칤a</div>
                </label>

            </div>

            <div id="category-section" class="mb-3 text-start d-none">
                <label class="form-label fw-bold">쮺u치l crees que es la causa ra칤z?</label>
                <select name="category-visible" id="category-select" class="form-select">
                    <option value="" selected disabled>Selecciona una causa...</option>
                    <option value="Sobrecarga">Sobrecarga de trabajo / Presi칩n excesiva</option>
                    <option value="Reconocimiento">Falta de reconocimiento / Valoraci칩n</option>
                    <option value="Comunicacion">Problemas de comunicaci칩n / Conflictos</option>
                    <option value="Recursos">Falta de recursos / Herramientas inadecuadas</option>
                    <option value="Ambiente">Ambiente laboral negativo / T칩xico</option>
                    <option value="Inseguridad">Inseguridad laboral / Incertidumbre</option>
                    <option value="Desarrollo">Falta de desarrollo / Oportunidades</option>
                    <option value="Liderazgo">Problemas con liderazgo / Gesti칩n</option>
                </select>
            </div>

            <div class="mb-3">
                <textarea name="comment" class="form-control" placeholder="Comentario opcional..." rows="3"></textarea>
            </div>

            <button type="submit" class="btn btn-success w-100 btn-lg">Enviar Opini칩n</button>
        </form>
    </div>
</div>

<script>
    // Script para mostrar/ocultar la categor칤a y sincronizar valores
    function toggleCategory(show) {
        const section = document.getElementById('category-section');
        const selectElement = document.getElementById('category-select');
        const hiddenCategory = document.getElementById('hidden-category');
        
        if(show) {
            // Mostrar selector para emociones negativas
            section.classList.remove('d-none');
            selectElement.required = true;
            // NO desactivar el campo oculto, solo cambiar su valor
        } else {
            // Ocultar selector para emociones positivas/neutras
            section.classList.add('d-none');
            selectElement.required = false;
            selectElement.value = "";
            // Asegurar que el campo oculto tenga N/A
            hiddenCategory.value = "N/A";
        }
    }
    
    // Sincronizar el select visible con el campo oculto cuando cambie
    document.getElementById('category-select').addEventListener('change', function() {
        document.getElementById('hidden-category').value = this.value;
    });
</script>
{% endblock %}